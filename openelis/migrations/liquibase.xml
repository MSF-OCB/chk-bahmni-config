<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    <changeSet id="201509011514" author="Preethi,Sourav">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from site_information where name='defaultOrganizationName';
            </sqlCheck>
        </preConditions>
        <comment>Add default organization name for openelis</comment>
        <sql>
            INSERT INTO site_information(id, name, lastupdated, description, value, encrypted, value_type)  VALUES ( nextVal( 'site_information_seq' ) , 'defaultOrganizationName', now(), 'Default organization name for department to be synced from openmrs',  'Bahmni', 'f', 'text' );
        </sql>
    </changeSet>
    <changeSet id="201510121504" author="Preethi,Sourav">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from organization where name='Bahmni';
            </sqlCheck>
        </preConditions>
        <comment>Add Bahmni organization</comment>
        <sql>
            INSERT INTO organization(id, name)  VALUES ( nextVal( 'organization_seq' ) , 'Bahmni' );
        </sql>
    </changeSet>
    <changeSet id="201603021148" author="Preethi,Vikash">
        <comment>Update Active Flag for Bahmni Organization</comment>
        <sql>
            update organization set is_active='Y' where name='Bahmni';
        </sql>
    </changeSet>
    <changeSet id="20171229-10" author="vishnu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from organization where name='MSF';
            </sqlCheck>
        </preConditions>
        <comment>Add Bahmni organization</comment>
        <sql>
            INSERT INTO organization(id, name)  VALUES ( nextVal( 'organization_seq' ) , 'MSF' );
        </sql>
    </changeSet>
    <changeSet id="20171229-02" author="vishnu">
        <comment>Update Active Flag for Bahmni Organization</comment>
        <sql>
            update organization set is_active='Y' where name='MSF';
        </sql>
    </changeSet>

<changeSet id="20171229-003" author="Vishnu">
<comment> Removing the organizations other than MSF </comment>
        <sql>
            delete from test_section  where org_id in (select id from organization where name not in ('MSF'));
            delete from organization where name not in ('MSF');
        </sql>
   </changeSet>

<changeSet id="20171229-04" author="vishnu">
<preConditions>
<sqlCheck expectedResult ="0">
        select count(*) from site_information where name='SiteName' and value = 'MSF';
 </sqlCheck>
</preConditions>
   <sql>
   update site_information set value='Centre Hospitalier de Kinshasa' where id=23 and name='SiteName';
   </sql>
   </changeSet>


   <changeSet id="20171229-05" author="vishnu">
   <preConditions>
   <sqlCheck expectedResult= "5">
              select count(*) from sample_source where name in('IPD','OPD','Emergency','Sub Center','Community Program');
              </sqlCheck>
              </preConditions>
              <comment>Deleting the default Sample Sources</comment>
              <sql>
              delete from sample_source where name in('IPD','OPD','Emergency','Sub Center','Community Program');
              </sql>
              </changeSet>

              <changeSet id="20180102-01" author="vishnu">
              <preConditions>
              <sqlCheck expectedResult="0">
              select count(*) from site_information where value='/home/MSF' and name='parentOfUploadedFilesDirectory';
              </sqlCheck>
              </preConditions>
              <comment> Renaming the JSS folder to MSF Folder for results upload</comment>
              <sql>
              update site_information set value='/home/MSF' where value='/home/jss' and  name='parentOfUploadedFilesDirectory';
              </sql>
              </changeSet>

              <changeSet id="20180103-01" author="vishnu">
              <preConditions>
              <sqlCheck expectedResult="0">
              select count(*) from site_information where name='configuration name' and value='Centre Hospitalier de Kinshasa';
              </sqlCheck>
              </preConditions>
              <comment>Updating the configuration name to CHK Hospital</comment>
              <sql>
              update site_information set value='Centre Hospitalier de Kinshasa' where name='configuration name' and value='Haiti Clinical';
              </sql>
              </changeSet>

            <changeSet id="20180103-02" author="vishnu">
            <preConditions>
            <sqlCheck expectedResult="0">
            select count(*)  from site_information where name ='stNumberFormat';
            </sqlCheck>
            </preConditions>
            <comment> Updating the regexp for Patient Id </comment>
            <sql>
                 INSERT INTO site_information(id, name, lastupdated, description, value, encrypted, value_type)  VALUES (nextVal( 'site_information_seq' ) , 'stNumberFormat', now(), 'For Uploading Patient results for Patients without Prefix in Patient Identifier', '/.*/', 'f', 'text' );
            </sql>
            </changeSet>

</databaseChangeLog>
